<!-- Author: k88hudson -->
<html>
<head>
<style>
  
  body {
    font-family: "Helvetica";
    font-size: 100%;
  }
  .catalogueCode {
    font-family: Monaco;
    font-size: 12px;
    color: #F32520;
  }
  ol {
    list-style: none;
    padding: 0;
  }
  ol li {
    margin-bottom: 1em;
  }

  #container {
    width: 500px;
  }

  #calendars {
    position: fixed;
    right: 10px;
    bottom: 10px;
    width: 700px;
  }
  .calendar {
    width: 100%;
    border: 1px solid #000;
    margin-bottom: 10px;
  }

  .calendar .titles, .calendar .contents {
    width: 100%;
  }

  .calendar .titles div, .calendar .contents div {
    width: 20%;
    float: left;
    padding: 3px 0;
  }

 .calendar .contents div {
    min-height: 100px;
  }

  .calendar .contents div span {
    display: block;
    font-size: 12px;
    padding: 3px;
    background: #EEE;
    margin-bottom: 3px;
  }

  a.on {
    color: #98D337;
  }

.clearfix:after {
  content: ".";
  display: block;
  clear: both;
  visibility: hidden;
  line-height: 0;
  height: 0;
}
 
.clearfix {
  display: inline-block;
}
 
html[xmlns] .clearfix {
  display: block;
}
 
* html .clearfix {
  height: 1%;
}

</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>

</head>
<body>
<h1>YSDN 2012 &ndash; 2013</h1>
<p>This is a list of all YSDN courses scraped from yorku.ca. Download the raw data as JSON <a href="results.json">here.</a></p>
<p>Disclaimer: The last time the scraper was run was April 22, 2012. This is an experiment, so use at your own risk. If you find an error/bug please let me know (Tweet at @k88hudson, or email me)</p>
<div id="calendars">
  <h4>Fall</h4>
  <div class="calendar" id="calendar-F">
    <div class="titles clearfix"></div>
    <div class="contents clearfix"></div>
  </div>

  <h4>Winter</h4>
  <div class="calendar" id="calendar-W">
    <div class="titles clearfix"></div>
    <div class="contents clearfix"></div>
  </div>
</div>
<div id="container"></div>

<script>

makeSchedule();

$.ajax({
  url: "data.json",
  context: document.body,
  success: function(data){

     for(var i = 0; i < data.length; i++) {
    
         var course = data[i];
         //console.log(course);

         var el = $('<div id="row-'+(i+1)+'"></div>');
         var elements = new Object();

         for( var key in course ) {
          if (course.hasOwnProperty(key)) {
            
            var value = course[key];
            
            if(key === "title") {
              //Course Title
              elements.title = '<span class="title">'+ value + '</span>';
            } else if (key === "courseCode") {
              //Course Code        
              elements.courseCode = '<span class="courseCode">YSDN '+ value + '</span>';
            } else if (key === "credits") {
              //Credits
              elements.credits = '<span class="credits">' + value + '</span>';
            } else if (key === "offerings" && typeof value === "object") {
              //Offerings
              elements.offerings = $('<ol class="offerings"></ol>');
              for(var j = 0; j < value.length; j++) {
                var o = value[j];
                if(o.day) {
                  elements.offerings.append( '<li>'+ 
                    convertTerm(o.term) + "/" + o.location.campus + " " + o.type + ": "+ convertWeekDay(o.day) + " at " + convertTime(o.startTime) + 
                    ' [ <a class="catalogueCode" title="'+i+"-"+j+'">' + o.catalogueCode + "</a> ]" + 
                    "</li>" );
                }
              }//for
            }//if key...
          }//if hasOwnProperty...
         }//for

          el.append("<h3>" + elements.title + " " + elements.courseCode + " &ndash; " + elements.credits + " credits" + "</h3>");
          el.append(elements.offerings);

          $("#container").append(el);
      } //for

    //Stores all user's courses
    var userCourses = new Array();

    $(".catalogueCode").click(function(e){
      e.preventDefault();
      var dataCode = this.title;
      var inArray = jQuery.inArray(dataCode, userCourses);
      if(inArray === -1) {
        userCourses.push(dataCode);
        $(this).addClass("on");
      } else {
        userCourses.splice(inArray, 1);
        $(this).removeClass("on");
      }

      console.log(userCourses);
      makeTimeTable(userCourses);
      
    });

    function makeTimeTable(courses) {
      //Reset schedule
      makeSchedule();

      for(var c = 0; c < courses.length; c++) {
        var dataCode = courses[c].split("-");
        var courseName = data[dataCode[0]].title;
        var selection = data[dataCode[0]].offerings[dataCode[1]];

        //Add data
        if(selection.term === "F" || selection.term === "W") {
          var query = "#calendar-"+ selection.term + " .contents ." + convertWeekDay(selection.day);
          $(query).append("<span>" + convertTime(selection.startTime) + "<br /> " + courseName + "</span>");
        } else {
          var query1 = "#calendar-F" + " .contents ." + convertWeekDay(selection.day);
          var query2 = "#calendar-W" + " .contents ." + convertWeekDay(selection.day);
          $(query1).append("<span>" + convertTime(selection.startTime) + "<br /> " + courseName + "</span>");
          $(query2).append("<span>" + convertTime(selection.startTime) + "<br /> " + courseName + "</span>");
        }
      }
    }

  }//ajax

});

//HELPERS

function makeSchedule() {
  //Reset
  $("#calendar-F .titles").html("");
  $("#calendar-F .contents").html("");
  $("#calendar-W .titles").html("");
  $("#calendar-W .contents").html("");

  //Create each day
  for(var day=0; day<5; day++) {
    var dayName = convertNumberToDay(day+1);
    $("#calendar-F .titles").append('<div class="' + dayName + '-title">'+ dayName +'</div>');
    $("#calendar-F .contents").append('<div class="' + dayName + '">'+'</div>');
    $("#calendar-W .titles").append('<div class="' + dayName + '-title">'+ dayName +'</div>');
    $("#calendar-W .contents").append('<div class="' + dayName + '">'+'</div>');
  }
}

function convertNumberToDay(w) {
    if(w === 1) {
      return "Monday";
    } else if (w == 2) {
      return "Tuesday";
    } else if (w == 3) {
      return "Wednesday";
    } else if (w == 4) {
      return "Thursday";
    } else if (w == 5) {
      return "Friday";
    }
  }

function convertWeekDay(w) {
    if(w === "M") {
      return "Monday";
    } else if (w == "T") {
      return "Tuesday";
    } else if (w == "W") {
      return "Wednesday";
    } else if (w == "R") {
      return "Thursday";
    } else if (w == "F") {
      return "Friday";
    }
  }

function convertTerm(term) {
  if(term === "F") {
    return "Fall";
  } else if (term === "W") {
    return "Winter";
  } else {
    return "Year"
  }
}

function convertTime(t) {
  var hour, min, amPm;
    if(t) {
      t = t.split(":");
    hour = parseInt(t[0]);
    min = t[1];

    if(hour > 12) {
      hour = hour - 12;
      amPm = "PM";
    } else if (hour === 12) {
      amPm = "PM";
    } else {
      amPm = "AM";
    }

    return hour + ":" + min + " " + amPm;
  }
}
</script>
</body>
</html>